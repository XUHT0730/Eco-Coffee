import{_ as U,i as B,m as x,r as b,o as r,c as d,a as i,b as e,F as k,j as T,h as u,t as m,d as C,v as V,e as S,f as L,n as y}from"./index-DWtJNFht.js";import{S as v}from"./sweetalert2.all-qACaC20D.js";import{c as I}from"./cartStore-CAI-OPSQ.js";import{t as w}from"./toastMessage-LA9Y6pzp.js";var q={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"hedy-api-path",BASE_URL:"/Eco-Coffee/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:h,VITE_PATH:p}=q,A={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},isLoading:!1,coupon_code:""}},computed:{...B(I,["cart"])},methods:{...x(w,["pushMessage"]),...x(I,["getCart","addToCart"]),updateCart(t){this.isLoading=!0;const s=`${h}/api/${p}/cart/${t.id}`,a={product_id:t.product_id,qty:t.qty};this.axios.put(s,{data:a}).then(f=>{this.pushMessage({style:"success",title:"更新購物車",content:f.data.message}),this.isLoading=!1,this.getCart()}).catch(f=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"更新購物車",content:f.response.data.message})})},delCartItem(t){this.status.loadingItem=t;const s=`${h}/api/${p}/cart/${t}`;this.isLoading=!0,this.axios.delete(s).then(a=>{this.pushMessage({style:"success",title:"移除購物車品項",content:a.data.message}),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(a=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"移除購物車品項",content:a.response.data.message})})},delAllCarts(){this.isLoading=!0,v.fire({title:"確定清空購物車?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確定",cancelButtonText:"取消"}).then(t=>{if(t.isConfirmed){const s=`${h}/api/${p}/carts`;this.axios.delete(s).then(a=>{this.getCart(),this.isLoading=!1,v.fire({title:"清除購物車",content:a.data.message,icon:"success"})}).catch(a=>{this.isLoading=!1,v.fire({icon:"error",title:a.response.data.message})})}else this.isLoading=!1})},addCouponCode(){const t=`${h}/api/${p}/coupon`,s={code:this.coupon_code};this.isLoading=!0,this.axios.post(t,{data:s}).then(a=>{this.pushMessage({style:"success",title:"加入優惠券",content:a.data.message}),this.getCart(),this.isLoading=!1}).catch(a=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入優惠券",content:a.response.data.message})})},createOrder(){if(this.cart.carts&&this.cart.carts.length===0){v.fire({icon:"error",title:"購物車為空",footer:'<a href="#">Why do I have this issue?</a>'});return}this.isLoading=!0;const t=`${h}/api/${p}/order`,s=this.form;this.axios.post(t,{data:s}).then(a=>{this.$router.push(`/checkout/${a.data.orderId}`),this.$refs.form.resetForm(),this.isLoading=!1}).catch(a=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"建立訂單",content:a.response.data.message})})}},mounted(){this.getCart()}},F={class:"container"},O={class:"mt-4"},D={key:0},R={class:"text-end"},N={class:"table align-middle"},P=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"110px"}},"數量"),e("th",null,"單價")])],-1),j=["onClick","disabled"],z={key:0,class:"fas fa-spinner fa-pulse"},H={key:0,class:"text-success"},W={class:"input-group input-group-sm"},$=["onUpdate:modelValue","onBlur","disabled"],G={class:"input-group-text",id:"basic-addon2"},J={class:"text-end"},K={key:0,class:"text-success"},Q=e("td",{colspan:"3",class:"text-end"},"總計",-1),X={class:"text-end"},Y={key:0},Z=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ee={class:"text-end text-success"},te={class:"input-group mb-3 input-group-sm"},se={class:"input-group-append"},oe={key:1,class:"text-center text-danger"},ae=e("p",null,"購物車目前無商品",-1),le=[ae],ne={class:"my-5 row justify-content-center"},ie={class:"mb-3"},re=e("label",{for:"email",class:"form-label"},"Email",-1),de={class:"mb-3"},ce=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),ue={class:"mb-3"},me=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),he={class:"mb-3"},pe=e("label",{for:"address",class:"form-label"},"收件人地址",-1),fe={class:"mb-3"},_e=e("label",{for:"message",class:"form-label"},"留言",-1),ge=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function be(t,s,a,f,l,c){const E=b("LoadingOverLay"),_=b("VeeField"),g=b("ErrorMessage"),M=b("VeeForm");return r(),d(k,null,[i(E,{active:l.isLoading,"z-index":1060},null,8,["active"]),e("div",F,[e("div",O,[t.cart.carts&&t.cart.carts.length>0?(r(),d("div",D,[e("div",R,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...o)=>c.delAllCarts&&c.delAllCarts(...o))}," 清空購物車 ")]),e("table",N,[P,e("tbody",null,[t.cart.carts?(r(!0),d(k,{key:0},T(t.cart.carts,o=>(r(),d("tr",{key:o.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:n=>c.delCartItem(o.id),disabled:l.status.loadingItem===o.id},[l.status.loadingItem===o.id?(r(),d("i",z)):u("",!0),L(" x ")],8,j)]),e("td",null,[L(m(o.product.title)+" ",1),o.coupon?(r(),d("div",H,"已套用優惠券")):u("",!0)]),e("td",null,[e("div",W,[C(e("input",{type:"number",class:"form-control w-50",min:"1","onUpdate:modelValue":n=>o.qty=n,onBlur:n=>c.updateCart(o),disabled:l.status.loadingItem===o.id},null,40,$),[[V,o.qty,void 0,{number:!0}]]),e("span",G,m(o.product.unit),1)])]),e("td",J,[t.cart.final_total!==t.cart.total?(r(),d("small",K,"折扣價：")):u("",!0),L(" "+m(t.$filters.currency(o.final_total)),1)])]))),128)):u("",!0)]),e("tfoot",null,[e("tr",null,[Q,e("td",X,m(t.$filters.currency(t.cart.total)),1)]),t.cart.final_total!==t.cart.total?(r(),d("tr",Y,[Z,e("td",ee,m(t.$filters.currency(t.cart.final_total)),1)])):u("",!0)])]),e("div",te,[C(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=o=>l.coupon_code=o),placeholder:"請輸入優惠碼"},null,512),[[V,l.coupon_code]]),e("div",se,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[2]||(s[2]=(...o)=>c.addCouponCode&&c.addCouponCode(...o))}," 套用優惠碼 ")])])])):(r(),d("div",oe,le)),e("div",ne,[i(M,{ref:"form",class:"col-md-6",onSubmit:c.createOrder},{default:S(({errors:o})=>[e("div",ie,[re,i(_,{id:"email",name:"email",type:"email",class:y(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":s[3]||(s[3]=n=>l.form.user.email=n)},null,8,["class","modelValue"]),i(g,{name:"email",class:"invalid-feedback"})]),e("div",de,[ce,i(_,{id:"name",name:"姓名",type:"text",class:y(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":s[4]||(s[4]=n=>l.form.user.name=n)},null,8,["class","modelValue"]),i(g,{name:"姓名",class:"invalid-feedback"})]),e("div",ue,[me,i(_,{id:"tel",name:"電話",type:"tel",class:y(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:l.form.user.tel,"onUpdate:modelValue":s[5]||(s[5]=n=>l.form.user.tel=n)},null,8,["class","modelValue"]),i(g,{name:"電話",class:"invalid-feedback"})]),e("div",he,[pe,i(_,{id:"address",name:"地址",type:"text",class:y(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[6]||(s[6]=n=>l.form.user.address=n)},null,8,["class","modelValue"]),i(g,{name:"地址",class:"invalid-feedback"})]),e("div",fe,[_e,C(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[7]||(s[7]=n=>l.form.message=n)},null,512),[[V,l.form.message]])]),ge]),_:1},8,["onSubmit"])])])])],64)}const Le=U(A,[["render",be]]);export{Le as default};
