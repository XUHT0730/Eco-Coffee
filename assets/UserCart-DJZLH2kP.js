import{_ as E,m as x,r as b,o as r,c,a as i,b as e,F as L,j as I,h as u,t as m,d as v,v as C,e as U,f as V,n as y}from"./index-Bnjvlgro.js";import{c as S}from"./cartStore-DZd-oacZ.js";import{t as T}from"./toastMessage-De8WdkPR.js";var q={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"hedy-api-path",BASE_URL:"/Eco-Coffee/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p,VITE_PATH:h}=q,A={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:""}},methods:{...x(T,["pushMessage"]),...x(S,["getCart","addToCart"]),updateCart(a){this.isLoading=!0;const s=`${p}/api/${h}/cart/${a.id}`,l={product_id:a.product_id,qty:a.qty};this.axios.put(s,{data:l}).then(g=>{this.pushMessage({style:"success",title:"更新購物車",content:g.data.message}),this.isLoading=!1,this.getCart()}).catch(g=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"更新購物車",content:g.response.data.message})})},delCartItem(a){this.status.loadingItem=a;const s=`${p}/api/${h}/cart/${a}`;this.isLoading=!0,this.axios.delete(s).then(l=>{this.pushMessage({style:"success",title:"移除購物車品項",content:l.data.message}),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(l=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"移除購物車品項",content:l.response.data.message})})},delAllCarts(){this.isLoading=!0;const a=`${p}/api/${h}/carts`;this.axios.delete(a).then(s=>{this.pushMessage({style:"success",title:"清除購物車",content:s.data.message}),this.getCart(),this.isLoading=!1}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"清除購物車",content:s.response.data.message})})},addCouponCode(){const a=`${p}/api/${h}/coupon`,s={code:this.coupon_code};this.isLoading=!0,this.axios.post(a,{data:s}).then(l=>{this.pushMessage({style:"success",title:"加入優惠券",content:l.data.message}),this.getCart(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"加入優惠券",content:l.response.data.message})})},createOrder(){if(this.cart.carts&&this.cart.carts.length===0)return;this.isLoading=!0;const a=`${p}/api/${h}/order`,s=this.form;this.axios.post(a,{data:s}).then(l=>{this.$router.push(`/checkout/${l.data.orderId}`),this.$refs.form.resetForm(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"建立訂單",content:l.response.data.message})})}},mounted(){this.getCart()}},F={class:"container"},B={class:"mt-4"},O={class:"text-end"},w={class:"table align-middle"},D=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"110px"}},"數量"),e("th",null,"單價")])],-1),R=["onClick","disabled"],N={key:0,class:"fas fa-spinner fa-pulse"},P={key:0,class:"text-success"},j={class:"input-group input-group-sm"},z=["onUpdate:modelValue","onBlur","disabled"],H={class:"input-group-text",id:"basic-addon2"},G={class:"text-end"},J={key:0,class:"text-success"},K=e("td",{colspan:"3",class:"text-end"},"總計",-1),Q={class:"text-end"},W={key:0},X=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Y={class:"text-end text-success"},Z={class:"input-group mb-3 input-group-sm"},$={class:"input-group-append"},ee={class:"my-5 row justify-content-center"},se={class:"mb-3"},te=e("label",{for:"email",class:"form-label"},"Email",-1),oe={class:"mb-3"},ae=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),le={class:"mb-3"},ne=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),ie={class:"mb-3"},de=e("label",{for:"address",class:"form-label"},"收件人地址",-1),re={class:"mb-3"},ce=e("label",{for:"message",class:"form-label"},"留言",-1),ue=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function me(a,s,l,g,o,d){const k=b("LoadingOverLay"),_=b("VeeField"),f=b("ErrorMessage"),M=b("VeeForm");return r(),c(L,null,[i(k,{active:o.isLoading,"z-index":1060},null,8,["active"]),e("div",F,[e("div",B,[e("div",O,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...t)=>d.delAllCarts&&d.delAllCarts(...t))}," 清空購物車 ")]),e("table",w,[D,e("tbody",null,[o.cart.carts?(r(!0),c(L,{key:0},I(o.cart.carts,t=>(r(),c("tr",{key:t.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:n=>d.delCartItem(t.id),disabled:a.loadingStatus.loadingItem===t.id},[a.loadingStatus.loadingItem===t.id?(r(),c("i",N)):u("",!0),V(" x ")],8,R)]),e("td",null,[V(m(t.product.title)+" ",1),t.coupon?(r(),c("div",P,"已套用優惠券")):u("",!0)]),e("td",null,[e("div",j,[v(e("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":n=>t.qty=n,onBlur:n=>d.updateCart(t),disabled:a.loadingStatus.loadingItem===t.id},null,40,z),[[C,t.qty,void 0,{number:!0}]]),e("span",H,m(t.product.unit),1)])]),e("td",G,[o.cart.final_total!==o.cart.total?(r(),c("small",J,"折扣價：")):u("",!0),V(" "+m(a.$filters.currency(t.final_total)),1)])]))),128)):u("",!0)]),e("tfoot",null,[e("tr",null,[K,e("td",Q,m(a.$filters.currency(o.cart.total)),1)]),o.cart.final_total!==o.cart.total?(r(),c("tr",W,[X,e("td",Y,m(a.$filters.currency(o.cart.final_total)),1)])):u("",!0)])]),e("div",Z,[v(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=t=>o.coupon_code=t),placeholder:"請輸入優惠碼"},null,512),[[C,o.coupon_code]]),e("div",$,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[2]||(s[2]=(...t)=>d.addCouponCode&&d.addCouponCode(...t))}," 套用優惠碼 ")])]),e("div",ee,[i(M,{ref:"form",class:"col-md-6",onSubmit:d.createOrder},{default:U(({errors:t})=>[e("div",se,[te,i(_,{id:"email",name:"email",type:"email",class:y(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":s[3]||(s[3]=n=>o.form.user.email=n)},null,8,["class","modelValue"]),i(f,{name:"email",class:"invalid-feedback"})]),e("div",oe,[ae,i(_,{id:"name",name:"姓名",type:"text",class:y(["form-control",{"is-invalid":t.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":s[4]||(s[4]=n=>o.form.user.name=n)},null,8,["class","modelValue"]),i(f,{name:"姓名",class:"invalid-feedback"})]),e("div",le,[ne,i(_,{id:"tel",name:"電話",type:"tel",class:y(["form-control",{"is-invalid":t.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:o.form.user.tel,"onUpdate:modelValue":s[5]||(s[5]=n=>o.form.user.tel=n)},null,8,["class","modelValue"]),i(f,{name:"電話",class:"invalid-feedback"})]),e("div",ie,[de,i(_,{id:"address",name:"地址",type:"text",class:y(["form-control",{"is-invalid":t.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":s[6]||(s[6]=n=>o.form.user.address=n)},null,8,["class","modelValue"]),i(f,{name:"地址",class:"invalid-feedback"})]),e("div",re,[ce,v(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[7]||(s[7]=n=>o.form.message=n)},null,512),[[C,o.form.message]])]),ue]),_:1},8,["onSubmit"])])])])],64)}const _e=E(A,[["render",me]]);export{_e as default};
