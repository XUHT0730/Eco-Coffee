import{m as w,_ as C,r as h,o as d,c as a,a as n,e as E,b as e,d as f,v as b,f as T,h as U,F as V,i as k,n as g,j as D,t as P}from"./index-Cu498o3N.js";import{t as L}from"./toastMessage-DCzfFjLU.js";import{P as I}from"./PaginationComponent-CGWmvErq.js";import{m as F,D as N}from"./DeleteModal-iBAQXipr.js";import"./selector-engine-DSwJHdnT.js";var R={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"hedy-api-path",BASE_URL:"/Eco-Coffee/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:$,VITE_PATH:A}=R,S={props:{product:Object,isNew:Boolean},data(){return{status:{},modal:"",tempProduct:{}}},emits:["update-product"],mixins:[F],watch:{product(){this.tempProduct=this.product,this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.tempProduct.imageUrl||(this.tempProduct.imageUrl="")}},methods:{...w(L,["pushMessage"]),uploadFile(){const i=this.$refs.fileInput.files[0],s=new FormData;s.append("file-to-upload",i);const l=`${$}/api/${A}/admin/upload`;this.status.fileUploading=!0,this.$http.post(l,s,{headers:{"Content-Type":"multipart/form-data"}}).then(c=>{this.status.fileUploading=!1,this.tempProduct.imageUrl=c.data.imageUrl,this.$refs.fileInput.value="",this.pushMessage({style:"success",title:"圖片上傳結果",content:c.data.message})}).catch(c=>{this.status.fileUploading=!1,this.pushMessage({style:"danger",title:"圖片上傳結果",content:c.response.data.message})})}}},O={class:"modal fade",id:"myModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},B={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},H={class:"modal-header bg-dark text-white"},j={class:"modal-title",id:"exampleModalLabel"},z={key:0},G={key:1},J=e("button",{type:"button",class:"btn-close bg-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),K={class:"modal-body"},Q={class:"row"},W={class:"col-sm-4"},X={class:"mb-3"},Y=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),Z={class:"mb-3"},ee={for:"customFile",class:"form-label"},te={key:0,class:"fas fa-spinner fa-spin"},se=["src"],oe={key:0,class:"mt-5"},le=["onUpdate:modelValue"],ie=["src"],ne=["onClick"],de={key:0},ae={class:"col-sm-8"},ce={class:"mb-3"},re=e("label",{for:"title",class:"form-label"},"標題",-1),ue={class:"row gx-2"},me={class:"mb-3 col-md-6"},pe=e("label",{for:"category",class:"form-label"},"分類",-1),he={class:"mb-3 col-md-6"},_e=e("label",{for:"unit",class:"form-label"},"單位",-1),fe={class:"row gx-2"},ge={class:"mb-3 col-md-6"},be=e("label",{for:"origin_price",class:"form-label"},"原價",-1),Pe={class:"mb-3 col-md-6"},ve=e("label",{for:"price",class:"form-label"},"售價",-1),ye=e("hr",null,null,-1),Me={class:"mb-3"},Ue=e("label",{for:"description",class:"form-label"},"產品描述",-1),Ve={class:"mb-3"},xe=e("label",{for:"content",class:"form-label"},"說明內容",-1),we={class:"mb-3"},Ce={class:"form-check"},ke=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Le=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{type:"submit",class:"btn btn-primary"},"確認")],-1);function Ee(i,s,l,c,t,r){const m=h("VeeField"),p=h("ErrorMessage"),M=h("VeeForm");return d(),a("div",O,[n(M,{ref:"form",onSubmit:s[11]||(s[11]=u=>i.$emit("update-product",t.tempProduct))},{default:E(({errors:u})=>[e("div",B,[e("div",q,[e("div",H,[e("h5",j,[l.isNew?(d(),a("span",z,"新增產品")):(d(),a("span",G,"編輯產品"))]),J]),e("div",K,[e("div",Q,[e("div",W,[e("div",X,[Y,f(e("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":s[0]||(s[0]=o=>t.tempProduct.imageUrl=o),placeholder:"請輸入圖片連結"},null,512),[[b,t.tempProduct.imageUrl]])]),e("div",Z,[e("label",ee,[T("或 上傳圖片 "),t.status.fileUploading?(d(),a("i",te)):U("",!0)]),e("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:s[1]||(s[1]=(...o)=>r.uploadFile&&r.uploadFile(...o))},null,544)]),e("img",{class:"img-fluid",src:t.tempProduct.imageUrl},null,8,se),t.tempProduct.imagesUrl?(d(),a("div",oe,[(d(!0),a(V,null,k(t.tempProduct.imagesUrl,(o,_)=>(d(),a("div",{class:"mb-3",key:_},[f(e("input",{type:"url",class:"form-control form-control","onUpdate:modelValue":x=>t.tempProduct.imagesUrl[_]=x,placeholder:"請輸入連結"},null,8,le),[[b,t.tempProduct.imagesUrl[_]]]),e("div",null,[e("img",{class:"img-fluid",src:o},null,8,ie)]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:x=>t.tempProduct.imagesUrl.splice(_,1)}," 移除 ",8,ne)]))),128)),t.tempProduct.imagesUrl[t.tempProduct.imagesUrl.length-1]||!t.tempProduct.imagesUrl.length?(d(),a("div",de,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[2]||(s[2]=o=>t.tempProduct.imagesUrl.push(""))}," 新增圖片 ")])):U("",!0)])):U("",!0)]),e("div",ae,[e("div",ce,[re,n(m,{id:"title",name:"title",type:"text",class:g(["form-control",{"is-invalid":u.title}]),placeholder:"請輸入標題",rules:"required",modelValue:t.tempProduct.title,"onUpdate:modelValue":s[3]||(s[3]=o=>t.tempProduct.title=o)},null,8,["class","modelValue"]),n(p,{name:"title",class:"invalid-feedback"})]),e("div",ue,[e("div",me,[pe,n(m,{id:"category",name:"category",type:"text",class:g(["form-control",{"is-invalid":u.category}]),placeholder:"請輸入分類",rules:"required",modelValue:t.tempProduct.category,"onUpdate:modelValue":s[4]||(s[4]=o=>t.tempProduct.category=o)},null,8,["class","modelValue"]),n(p,{name:"category",class:"invalid-feedback"})]),e("div",he,[_e,n(m,{id:"unit",name:"unit",type:"text",class:g(["form-control",{"is-invalid":u.unit}]),placeholder:"請輸入單位",rules:"required",modelValue:t.tempProduct.unit,"onUpdate:modelValue":s[5]||(s[5]=o=>t.tempProduct.unit=o)},null,8,["class","modelValue"]),n(p,{name:"unit",class:"invalid-feedback"})])]),e("div",fe,[e("div",ge,[be,n(m,{id:"origin_price",name:"origin_price",type:"number",class:g(["form-control",{"is-invalid":u.origin_price}]),placeholder:"請輸入原價",rules:"required",modelValue:t.tempProduct.origin_price,"onUpdate:modelValue":s[6]||(s[6]=o=>t.tempProduct.origin_price=o),modelModifiers:{number:!0}},null,8,["class","modelValue"]),n(p,{name:"origin_price",class:"invalid-feedback"})]),e("div",Pe,[ve,n(m,{id:"price",name:"price",type:"number",class:g(["form-control",{"is-invalid":u.price}]),placeholder:"請輸入售價",rules:"required|min_value:0",modelValue:t.tempProduct.price,"onUpdate:modelValue":s[7]||(s[7]=o=>t.tempProduct.price=o),modelModifiers:{number:!0}},null,8,["class","modelValue"]),n(p,{name:"price",class:"invalid-feedback"})])]),ye,e("div",Me,[Ue,f(e("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":s[8]||(s[8]=o=>t.tempProduct.description=o),placeholder:"請輸入產品描述"},null,512),[[b,t.tempProduct.description]])]),e("div",Ve,[xe,f(e("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":s[9]||(s[9]=o=>t.tempProduct.content=o),placeholder:"請輸入產品說明內容"},null,512),[[b,t.tempProduct.content]])]),e("div",we,[e("div",Ce,[f(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[10]||(s[10]=o=>t.tempProduct.is_enabled=o),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[D,t.tempProduct.is_enabled]]),ke])])])])]),Le])])]),_:1},512)],512)}const Te=C(S,[["render",Ee]]);var De={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"hedy-api-path",BASE_URL:"/Eco-Coffee/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:v,VITE_PATH:y}=De,Ie={data(){return{products:[],pagination:{},isNew:!1,MyModal:null,DeleteModal:null,tempProduct:{imagesUrl:[]},isLoading:!1,state:{fileUploading:!1}}},methods:{...w(L,["pushMessage"]),getProducts(i=1){const s=`${v}/api/${y}/admin/products?page=${i}`;this.isLoading=!0,this.axios.get(s).then(l=>{const{products:c,pagination:t}=l.data;this.pagination=t,this.products=c,this.isLoading=!1,this.pushMessage({style:"success",title:"成功取得產品資訊",content:l.data.message})}).catch(l=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得產品資訊失敗",content:l.response.data.message})})},openModal(i,s){i==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,this.$refs.myModal.openModal()):i==="edit"?(this.tempProduct={...s},this.isNew=!1,this.$refs.myModal.openModal()):i==="delete"&&(this.tempProduct=s,this.$refs.deleteModal.openModal())},updateProduct(){let i=`${v}/api/${y}/admin/product/${this.tempProduct.id}`;this.isLoading=!0;let s="put",l="更新產品";this.isNew&&(i=`${v}/api/${y}/admin/product`,s="post",l="新增產品");const c=this.$refs.myModal;this.axios[s](i,{data:this.tempProduct}).then(t=>{this.isLoading=!1,this.pushMessage({style:"success",title:l,content:t.data.message}),this.getProducts(),c.hideModal(),this.tempProduct={}}).catch(t=>{this.isLoading=!1,this.pushMessage({style:"danger",title:l,content:t.response.data.message})})},delProduct(){const i=`${v}/api/${y}/admin/product/${this.tempProduct.id}`;this.isLoading=!0,this.axios.delete(i).then(s=>{this.isLoading=!1,this.pushMessage({style:"success",title:"刪除產品",content:s.data.message}),this.$refs.deleteModal.hideModal(),this.getProducts()}).catch(s=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"刪除產品",content:s.response.data.message})})}},mounted(){this.getProducts()},components:{PaginationComponent:I,MyModal:Te,DeleteModal:N}},Fe={class:"container"},Ne={class:"text-end mt-3"},Re={class:"table table-responsive table-striped mt-4"},$e=e("thead",null,[e("tr",null,[e("th",{width:"120",class:"d-none d-sm-table-cell"},"分類"),e("th",null,"產品名稱"),e("th",{width:"100",class:"d-none d-sm-table-cell"},"原價"),e("th",{width:"100"},"售價"),e("th",{width:"100",class:"text-nowrap"},"是否啟用"),e("th",{width:"120",class:"text-nowrap"},"編輯")])],-1),Ae={width:"150",class:"d-none d-sm-table-cell"},Se={width:"120"},Oe={class:"text-end d-none d-sm-table-cell"},Be={class:"text-end"},qe={style:{"white-space":"nowrap"}},He={key:0,class:"text-success"},je={key:1},ze={class:"btn-group"},Ge=["onClick"],Je=["onClick"],Ke={class:"d-flex justify-content-center"};function Qe(i,s,l,c,t,r){const m=h("LoadingOverLay"),p=h("PaginationComponent"),M=h("MyModal"),u=h("DeleteModal");return d(),a(V,null,[n(m,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("div",Fe,[e("div",Ne,[e("button",{type:"button",class:"btn btn-primary",onClick:s[0]||(s[0]=o=>r.openModal("new"))}," 建立新的產品 ")]),e("table",Re,[$e,e("tbody",null,[(d(!0),a(V,null,k(t.products,o=>(d(),a("tr",{key:o.id},[e("td",Ae,P(o.category),1),e("td",Se,P(o.title),1),e("td",Oe,P(o.origin_price),1),e("td",Be,P(o.price),1),e("td",qe,[o.is_enabled?(d(),a("span",He,"啟用")):(d(),a("span",je,"未啟用"))]),e("td",null,[e("div",ze,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:_=>r.openModal("edit",o)}," 編輯 ",8,Ge),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:_=>r.openModal("delete",o)}," 刪除 ",8,Je)])])]))),128))])]),e("div",Ke,[n(p,{pagination:t.pagination,onEmitPages:r.getProducts},null,8,["pagination","onEmitPages"])])]),n(M,{product:t.tempProduct,onUpdateProduct:r.updateProduct,"is-new":t.isNew,ref:"myModal"},null,8,["product","onUpdateProduct","is-new"]),n(u,{item:t.tempProduct,onDelItem:r.delProduct,ref:"deleteModal"},null,8,["item","onDelItem"])],64)}const tt=C(Ie,[["render",Qe]]);export{tt as default};
